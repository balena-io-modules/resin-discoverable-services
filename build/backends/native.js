// Generated by CoffeeScript 1.11.1
(function() {
  var NativeServiceBrowser, Promise, bonjour;

  Promise = require('bluebird');

  bonjour = require('bonjour');

  NativeServiceBrowser = (function() {
    function NativeServiceBrowser(timeout1) {
      this.timeout = timeout1;
      this.findInstance = bonjour();
    }

    NativeServiceBrowser.prototype.find = function(registeredService, serviceDetails) {
      return new Promise((function(_this) {
        return function(resolve) {
          var browser, foundServices;
          foundServices = [];
          browser = _this.findInstance.find({
            type: serviceDetails.type,
            subtypes: serviceDetails.subtypes,
            protocol: serviceDetails.protocol
          }, function(service) {
            service.service = registeredService.service;
            return foundServices.push(service);
          });
          return setTimeout(function() {
            browser.stop();
            return resolve(foundServices);
          }, _this.timeout);
        };
      })(this));
    };

    NativeServiceBrowser.prototype.destroy = function() {
      return this.findInstance.destroy();
    };

    return NativeServiceBrowser;

  })();

  module.exports = function(timeout) {
    return Promise.resolve(new NativeServiceBrowser(timeout)).disposer(function(serviceBrowser) {
      return serviceBrowser.destroy();
    });
  };

}).call(this);
